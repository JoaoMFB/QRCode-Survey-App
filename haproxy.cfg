# Global settings for HAProxy
global
    log         127.0.0.1 local2       # Log to localhost
    pidfile     /var/run/haproxy.pid  # Location of PID file
    maxconn     4000                  # Maximum number of connections

# Default settings for all services
defaults
    mode                    http
    log                     global
    option                  httplog             # Enable detailed HTTP logging
    option                  dontlognull         # Don't log connections with no data
    option http-server-close                    # Close HTTP connection after each response
    option forwardfor       except 127.0.0.0/8  # Forward original client IP
    option                  redispatch          # Retry other servers if one fails
    retries                 3
    timeout http-request    10s
    timeout queue           1m
    timeout connect         10s
    timeout client          1m
    timeout server          1m
    timeout http-keep-alive 10s 
    timeout check           10s
    maxconn                 3000

# Frontend configuration: listen on port 80
frontend http_front
    bind *:80                      # Listen on all interfaces, port 80
    default_backend http_back     # Forward requests to backend group

# Backend configuration: balance between web1 and web2
backend http_back
    balance roundrobin            # Distribute requests in round-robin fashion
    server web1 web1:8000 check   # First app server, with health check
    server web2 web2:8000 check   # Second app server, with health check
